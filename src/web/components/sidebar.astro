---
import type { Data } from '@/types/data';

import SidebarItem from './sidebar-item.astro';

export interface Props {
  className?: string;
  sections: Data['sections'];
}

const { className, sections } = Astro.props;
const sectionConfigs = Object.values(sections).map((section) => section.config);
---

<nav
  id="sidebar"
  class:list={[
    'hidden h-fit w-max flex-col gap-2 rounded-lg border-4 border-secondary-200 bg-primary-50 p-2 shadow-md dark:border-secondary-800 dark:bg-gray-800 xl:flex',
    className,
  ]}
>
  {sectionConfigs.filter((config) => config.visible).map((config) => <SidebarItem {...config} />)}
</nav>

<script>
  import hashState from '@/web/utils/hash-state';

  const sidebarItems = [...document.getElementById('sidebar')!.children] as HTMLAnchorElement[];

  const setActiveItem = (hash: string) => {
    sidebarItems.forEach((item) => {
      if (item.href.endsWith(hash)) {
        item.setAttribute('aria-current', 'page');
      } else {
        item.removeAttribute('aria-current');
      }
    });
  };

  setActiveItem(hashState.getHash());

  hashState.subscribe(setActiveItem);
</script>
